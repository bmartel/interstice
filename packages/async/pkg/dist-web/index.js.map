{"version":3,"file":"index.js","sources":["../dist-src/events.js","../dist-src/lazy.js","../dist-src/async-boundary.js","../dist-src/async-element.js"],"sourcesContent":["export const PENDING_EVENT = 'pending';\nexport const pending = promise => new CustomEvent(PENDING_EVENT, {\n  composed: true,\n  bubbles: true,\n  detail: {\n    promise\n  }\n});","import { directive } from 'lit-html';\nimport { pending } from './events.js';\nconst resolved = new WeakSet();\nexport const lazy = directive((importPromise, value) => part => {\n  if (!resolved.has(part)) {\n    importPromise.then(() => resolved.add(part));\n    part.startNode.parentNode.dispatchEvent(pending(importPromise));\n  }\n\n  part.setValue(value);\n});","import { PENDING_EVENT } from './events.js';\nexport const AsyncBoundary = base => class extends base {\n  static get properties() {\n    return {\n      _error: Boolean,\n      _pending: Boolean,\n      _pendingCount: Number\n    };\n  }\n\n  constructor() {\n    super();\n    this._pending = false;\n    this._pendingCount = 0;\n    this.addEventListener(PENDING_EVENT, async e => {\n      this._pending = true;\n      this._pendingCount++; //eslint-disable-line\n\n      try {\n        await e.detail.promise;\n      } catch (err) {\n        this._error = true;\n        this.error(err, e);\n      }\n\n      this._pendingCount--; //eslint-disable-line\n\n      this._pending = this._pendingCount !== 0;\n    });\n  }\n\n};","import { LitElement, html } from 'lit-element';\nimport { pending } from './events.js';\nexport class AsyncElement extends LitElement {\n  constructor() {\n    super();\n    this.deps = [];\n  }\n\n  firstUpdated() {\n    this.setup();\n  }\n\n  update(changedProps) {\n    if (this.deps.some(k => changedProps.has(k))) {\n      this.reload();\n    }\n\n    return super.update(changedProps);\n  }\n\n  setup() {\n    if (!this._loadedPromise) {\n      this.reload();\n    }\n  }\n\n  loader() {\n    this._loaded = null;\n    this._errored = null;\n    this._loadedPromise = new Promise((resolve, reject) => {\n      this._resolveLoaded = resolve;\n      this._rejectLoaded = reject;\n    });\n    pending(this._loadedPromise);\n\n    this._loadedPromise.then(data => {\n      this._loaded = () => data;\n\n      this.requestUpdate();\n      return data;\n    }).catch(err => {\n      this._errored = err;\n      this.requestUpdate();\n    });\n  }\n\n  reload() {\n    this.loader();\n    this.resolve();\n  }\n\n  loaded() {\n    return this._loaded;\n  }\n\n  errored() {\n    if (this._errored) {\n      return this.erroring(this._errored);\n    }\n\n    return null;\n  }\n\n  async resolve() {\n    try {\n      const data = await this.asyncRender();\n\n      this._resolveLoaded(data);\n\n      return data;\n    } catch (err) {\n      this._rejectLoaded(err);\n\n      return null;\n    }\n  }\n\n  erroring(err) {\n    return html``;\n  }\n\n  loading() {\n    return html``;\n  }\n\n  asyncRender() {\n    return Promise.reject('Must implement asyncRender() in child components');\n  }\n\n  render() {\n    const loaded = this.loaded();\n\n    if (loaded) {\n      return loaded();\n    }\n\n    const errored = this.errored();\n\n    if (errored) {\n      return errored;\n    }\n\n    return this.loading();\n  }\n\n}"],"names":[],"mappings":";;;AAAY,MAAC,aAAa,GAAG,UAAU;AAC3B,MAAC,OAAO,GAAG,OAAO,IAAI,IAAI,WAAW,CAAC,aAAa,EAAE;AACjE,EAAE,QAAQ,EAAE,IAAI;AAChB,EAAE,OAAO,EAAE,IAAI;AACf,EAAE,MAAM,EAAE;AACV,IAAI,OAAO;AACX,GAAG;AACH,CAAC;;ACLD,MAAM,QAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;AAC/B,AAAY,MAAC,IAAI,GAAG,SAAS,CAAC,CAAC,aAAa,EAAE,KAAK,KAAK,IAAI,IAAI;AAChE,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;AAC3B,IAAI,aAAa,CAAC,IAAI,CAAC,MAAM,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;AACjD,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,aAAa,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC;AACpE,GAAG;AACH;AACA,EAAE,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACvB,CAAC,CAAC;;ACTU,MAAC,aAAa,GAAG,IAAI,IAAI,cAAc,IAAI,CAAC;AACxD,EAAE,WAAW,UAAU,GAAG;AAC1B,IAAI,OAAO;AACX,MAAM,MAAM,EAAE,OAAO;AACrB,MAAM,QAAQ,EAAE,OAAO;AACvB,MAAM,aAAa,EAAE,MAAM;AAC3B,KAAK,CAAC;AACN,GAAG;AACH;AACA,EAAE,WAAW,GAAG;AAChB,IAAI,KAAK,EAAE,CAAC;AACZ,IAAI,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;AAC1B,IAAI,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;AAC3B,IAAI,IAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,MAAM,CAAC,IAAI;AACpD,MAAM,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AAC3B,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;AAC3B;AACA,MAAM,IAAI;AACV,QAAQ,MAAM,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC;AAC/B,OAAO,CAAC,OAAO,GAAG,EAAE;AACpB,QAAQ,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;AAC3B,QAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;AAC3B,OAAO;AACP;AACA,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;AAC3B;AACA,MAAM,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,KAAK,CAAC,CAAC;AAC/C,KAAK,CAAC,CAAC;AACP,GAAG;AACH;AACA,CAAC;;AC7BM,MAAM,YAAY,SAAS,UAAU,CAAC;AAC7C,EAAE,WAAW,GAAG;AAChB,IAAI,KAAK,EAAE,CAAC;AACZ,IAAI,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;AACnB,GAAG;AACH;AACA,EAAE,YAAY,GAAG;AACjB,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;AACjB,GAAG;AACH;AACA,EAAE,MAAM,CAAC,YAAY,EAAE;AACvB,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;AAClD,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC;AACpB,KAAK;AACL;AACA,IAAI,OAAO,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AACtC,GAAG;AACH;AACA,EAAE,KAAK,GAAG;AACV,IAAI,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;AAC9B,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC;AACpB,KAAK;AACL,GAAG;AACH;AACA,EAAE,MAAM,GAAG;AACX,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACxB,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACzB,IAAI,IAAI,CAAC,cAAc,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC3D,MAAM,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;AACpC,MAAM,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC;AAClC,KAAK,CAAC,CAAC;AACP,IAAI,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AACjC;AACA,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,IAAI;AACrC,MAAM,IAAI,CAAC,OAAO,GAAG,MAAM,IAAI,CAAC;AAChC;AACA,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;AAC3B,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI;AACpB,MAAM,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;AAC1B,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;AAC3B,KAAK,CAAC,CAAC;AACP,GAAG;AACH;AACA,EAAE,MAAM,GAAG;AACX,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;AAClB,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;AACnB,GAAG;AACH;AACA,EAAE,MAAM,GAAG;AACX,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC;AACxB,GAAG;AACH;AACA,EAAE,OAAO,GAAG;AACZ,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;AACvB,MAAM,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC1C,KAAK;AACL;AACA,IAAI,OAAO,IAAI,CAAC;AAChB,GAAG;AACH;AACA,EAAE,MAAM,OAAO,GAAG;AAClB,IAAI,IAAI;AACR,MAAM,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;AAC5C;AACA,MAAM,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;AAChC;AACA,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK,CAAC,OAAO,GAAG,EAAE;AAClB,MAAM,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AAC9B;AACA,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK;AACL,GAAG;AACH;AACA,EAAE,QAAQ,CAAC,GAAG,EAAE;AAChB,IAAI,OAAO,IAAI,CAAC,CAAC,CAAC;AAClB,GAAG;AACH;AACA,EAAE,OAAO,GAAG;AACZ,IAAI,OAAO,IAAI,CAAC,CAAC,CAAC;AAClB,GAAG;AACH;AACA,EAAE,WAAW,GAAG;AAChB,IAAI,OAAO,OAAO,CAAC,MAAM,CAAC,kDAAkD,CAAC,CAAC;AAC9E,GAAG;AACH;AACA,EAAE,MAAM,GAAG;AACX,IAAI,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;AACjC;AACA,IAAI,IAAI,MAAM,EAAE;AAChB,MAAM,OAAO,MAAM,EAAE,CAAC;AACtB,KAAK;AACL;AACA,IAAI,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;AACnC;AACA,IAAI,IAAI,OAAO,EAAE;AACjB,MAAM,OAAO,OAAO,CAAC;AACrB,KAAK;AACL;AACA,IAAI,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC;AAC1B,GAAG;AACH;AACA;;;;"}