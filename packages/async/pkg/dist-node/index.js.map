{"version":3,"file":"index.js","sources":["../dist-src/events.js","../dist-src/lazy.js","../dist-src/async-boundary.js","../dist-src/async-element.js"],"sourcesContent":["export const PENDING_EVENT = 'pending';\nexport const pending = promise => new CustomEvent(PENDING_EVENT, {\n  composed: true,\n  bubbles: true,\n  detail: {\n    promise\n  }\n});","import { directive } from 'lit-html';\nimport { pending } from './events.js';\nconst resolved = new WeakSet();\nexport const lazy = directive((importPromise, value) => part => {\n  if (!resolved.has(part)) {\n    importPromise.then(() => resolved.add(part));\n    part.startNode.parentNode.dispatchEvent(pending(importPromise));\n  }\n\n  part.setValue(value);\n});","import { PENDING_EVENT } from './events.js';\nexport const AsyncBoundary = base => class extends base {\n  static get properties() {\n    return {\n      _error: Boolean,\n      _pending: Boolean,\n      _pendingCount: Number\n    };\n  }\n\n  constructor() {\n    super();\n    this._pending = false;\n    this._pendingCount = 0;\n    this.addEventListener(PENDING_EVENT, async e => {\n      this._pending = true;\n      this._pendingCount++; //eslint-disable-line\n\n      try {\n        await e.detail.promise;\n      } catch (err) {\n        this._error = true;\n        this.error(err, e);\n      }\n\n      this._pendingCount--; //eslint-disable-line\n\n      this._pending = this._pendingCount !== 0;\n    });\n  }\n\n};","import { LitElement, html } from 'lit-element';\nimport { pending } from './events.js';\nexport class AsyncElement extends LitElement {\n  constructor() {\n    super();\n    this.deps = [];\n  }\n\n  firstUpdated() {\n    this.setup();\n  }\n\n  update(changedProps) {\n    if (this.deps.some(k => changedProps.has(k))) {\n      this.reload();\n    }\n\n    return super.update(changedProps);\n  }\n\n  setup() {\n    if (!this._loadedPromise) {\n      this.reload();\n    }\n  }\n\n  loader() {\n    this._loaded = null;\n    this._errored = null;\n    this._loadedPromise = new Promise((resolve, reject) => {\n      this._resolveLoaded = resolve;\n      this._rejectLoaded = reject;\n    });\n    pending(this._loadedPromise);\n\n    this._loadedPromise.then(data => {\n      this._loaded = () => data;\n\n      this.requestUpdate();\n      return data;\n    }).catch(err => {\n      this._errored = err;\n      this.requestUpdate();\n    });\n  }\n\n  reload() {\n    this.loader();\n    this.resolve();\n  }\n\n  loaded() {\n    return this._loaded;\n  }\n\n  errored() {\n    if (this._errored) {\n      return this.erroring(this._errored);\n    }\n\n    return null;\n  }\n\n  async resolve() {\n    try {\n      const data = await this.asyncRender();\n\n      this._resolveLoaded(data);\n\n      return data;\n    } catch (err) {\n      this._rejectLoaded(err);\n\n      return null;\n    }\n  }\n\n  erroring(err) {\n    return html``;\n  }\n\n  loading() {\n    return html``;\n  }\n\n  asyncRender() {\n    return Promise.reject('Must implement asyncRender() in child components');\n  }\n\n  render() {\n    const loaded = this.loaded();\n\n    if (loaded) {\n      return loaded();\n    }\n\n    const errored = this.errored();\n\n    if (errored) {\n      return errored;\n    }\n\n    return this.loading();\n  }\n\n}"],"names":["PENDING_EVENT","pending","promise","CustomEvent","composed","bubbles","detail","resolved","WeakSet","lazy","directive","importPromise","value","part","has","then","add","startNode","parentNode","dispatchEvent","setValue","AsyncBoundary","base","properties","_error","Boolean","_pending","_pendingCount","Number","constructor","addEventListener","e","err","error","AsyncElement","LitElement","deps","firstUpdated","setup","update","changedProps","some","k","reload","_loadedPromise","loader","_loaded","_errored","Promise","resolve","reject","_resolveLoaded","_rejectLoaded","data","requestUpdate","catch","loaded","errored","erroring","asyncRender","html","loading","render"],"mappings":"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"}